<!DOCTYPE html>
<html lang='en'>

<head>
  <title>Seoul Land Use: 1988-2008</title>
  <meta charset='utf-8'>
  <meta name='viewport' content='width=device-width, initial-scale=1'>
  <link href='https://api.mapbox.com/mapbox-assembly/v0.8.0/assembly.min.css' rel='stylesheet'>
  <link href='https://api.mapbox.com/mapbox.js/v3.0.1/mapbox.css' rel='stylesheet' />

  <style>
    h1 {
      color: #003478;
    }

    h2 {
      color: #C60C30;
    }

    .legend {
      background-color: #fff;
      border-radius: 3px;
      bottom: 30px;
      box-shadow: 0 1px 2px rgba(0, 0, 0, 0.10);
      font: 12px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif;
      padding: 10px;
      position: absolute;
      right: 10px;
      z-index: 1;
    }

    .legend h4 {
      font-size: 14px;
      margin: 0 0 10px;
    }

    .legend div span {
      border-radius: 50%;
      display: inline-block;
      height: 10px;
      margin-right: 5px;
      width: 10px;
    }
  </style>

</head>

<body>
  <div class='grid'>
    <div class='col col--12 col--3-ml p12 pb6 viewport-third viewport-full-ml'>
      <div class='h-full scroll-auto'>
        <h1 class='txt-subhead mb6'>Seoul Land Use: 1988-2008</h1>
        <p>This map uses open source land cover data from the Korean Ministry of Environment using Landsat TM and Landsat 7 imagery, administrative units from the Seoul Metropolitan Government, and greenbelt data from the Ministry of Land, Infrastructure
          and Transport. This map plots twenty year trends in urban development and green space between 1988 and 2008.</p>
        <h2 class='txt-xl mt18 mb12'>How to use this map:</h2>
        <p>Welcome to Seoul! This example will take you through one scenario for using this map to tell a particular story:</p>
        <p>1.</p>
        <p>2.</p>
        <p>3.</p>
        <footer class='mt12 bg-gray-faint txt-s'>
          <ul>
            <li>Explore the raw data: <a class='link' href='https://egis.me.go.kr/main.do'>Korea land cover</a>, <a class='link' href='https://data.seoul.go.kr/openinf/mapview.jsp?infId=OA-13222'>Seoul administrative units</a>, and <a class='link' href='https://openapi.nsdi.go.kr/nsdi/eios/OpenapiList.do?provOrg=NIA&gubun=F'>greenbelt boundaries</a></li>
            <li>Map authored by <a class='link' href='https://geography.as.uky.edu/users/jebowe3'>Jay Bowen</a></li>
          </ul>
        </footer>
      </div>
    </div>
    <div class='col col--12 col--9-ml h180 h-full-ml'>
      <div id="map" class='viewport-twothirds viewport-full-ml'></div>

      <!-- ui slider -->
      <div id='slider' class='range w240 bg-white border border--gray-light round-ml p12'>
        <input type='range' min="1988" max="2008" value="1" step="10" class="slider" />
      </div>

      <div id='landcover-legend' class='legend'>
        <h4><strong>Land Cover</strong></h4>
        <div><span style='background-color: #0602FA'></span>Water</div>
        <div><span style='background-color: #2A4B2D'></span>Forest</div>
        <div><span style='background-color: #399926'></span>Grass</div>
        <div><span style='background-color: #59CECA'></span>Exposed</div>
        <div><span style='background-color: #7C227E'></span>Marsh</div>
        <div><span style='background-color: #EEE907'></span>Farmland</div>
        <div><span style='background-color: #A9A9A9'></span>Urban</div>
      </div>

      <div id='temporal' class='py6 px12 bg-white border border--gray-light round bottom left wmax200'>
        <h3 class='txt-bold'>Year: <span></span></h3>
      </div>

    </div>
  </div>

  <script async defer src='https://api.mapbox.com/mapbox-assembly/v0.8.0/assembly.js'></script>
  <script src='https://api.mapbox.com/mapbox.js/v3.0.1/mapbox.js'></script>
  <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
  <script src="https://d3js.org/d3.v4.min.js"></script>


  <script>

  // mapbox access token for Jay's account
  L.mapbox.accessToken = 'pk.eyJ1IjoiamVib3dlMyIsImEiOiJjajY1M3l6bWIxeTQwMndtcXRuN3F4ejFpIn0.aE7P49pqaBKjy2HTOw-tgw';
  var map = L.mapbox.map('map', 'mapbox.light', {
    zoomSnap: 0.1,
    center: [37.5, 126.975],
    zoom: 10.5,
    minZoom: 9,
    maxZoom: 12,
    maxBounds: L.latLngBounds([38.0, 126.5], [37.0, 127.5])
  });

  // create empty layerGroup for holding currently displaced layer and add to map
  var displayLayer = L.layerGroup().addTo(map);

  // create an empty layerGroup for holding layers when not on map
  var landuseLayers = L.layerGroup();

  // load all the data asynchronously
  d3.queue()
    .defer(d3.json, 'data/SCA-Landcover-88.json')
    .defer(d3.json, 'data/SCA-Landcover-98.json')
    .await(makeMap);

  function makeMap(err, data88, data98) {

      // create Leaflet GeoJSON layer and add to landuseLayers
      var landUse88 = L.geoJson(data88, {
        style: function(feature) {
          return {
            stroke: 0,
            fillOpacity: 1,
            fillColor: getColor(feature.properties['landcover'])
          };
        }
      }); // add the first one to the map

      var landUse98 = L.geoJson(data98, {
        style: function(feature) {
          return {
            stroke: 0,
            fillOpacity: 1,
            fillColor: getColor(feature.properties['landcover'])
          };
        }
    }); // add the others to the temporary layer group

      // create an object to "map" the slider values to the layers
    var layersMap = {
      "1988": landUse88,
      "1998": landUse98
    };

    // example of how we can dynamically add a layer using the layersMap object
    displayLayer.addLayer(layersMap["1998"]);

    sequenceUI(layersMap);

  }

  function getColor(e, breaks) {

    if (e == "Water") {
      return '#0602FA';
    } else if (e == "Forest") {
      return '#2A4B2D';
    } else if (e == "Grass") {
      return '#399926';
    } else if (e == "Exposed") {
      return '#59CECA';
    } else if (e == "Marsh") {
      return '#7C227E';
    } else if (e == "Farmland") {
      return '#EEE907';
    } else if (e == "Urban") {
      return '#A9A9A9';
    }
  } // End getColor function

function sequenceUI(layersMap) {

    // create Leaflet control for the slider
    var sliderControl = L.control({
      position: 'bottomleft'
    });

    sliderControl.onAdd = function(map) {

      var controls = L.DomUtil.get("slider");

      L.DomEvent.disableScrollPropagation(controls);
      L.DomEvent.disableClickPropagation(controls);

      return controls;

    }

    // add the control to the map
    sliderControl.addTo(map);

    $('.slider')
      .on('change touch', function() {
        var currentYear = $(this).val();
        updateLayers(layersMap, currentYear);
      });

  }; // End sequenceUI function

  function updateLayers(layersMap, val) {
    // loop through our layersMap object
    for(var layer in layersMap) {
      // add the layer if matches the new value
      if(layer === val) {
        displayLayer.addLayer(layersMap[layer]);
      } else {
        // otherwise remove the layer
        displayLayer.removeLayer(layersMap[layer]);
      }
    }
  }

  // add a temporal legend in sync with the UI slider
  function createTemporalLegend(currentYear) {

    var temporalLegend = L.control({
      position: 'bottomleft' // place the temporal legend at bottom left corner
    });

    // when added to the map
    temporalLegend.onAdd = function(map) {

      var div = L.DomUtil.get("temporal"); // get the style settings

      // disable the mouse events
      L.DomEvent.disableScrollPropagation(div);
      L.DomEvent.disableClickPropagation(div);

      return div; // return the style settings

    }

    $('#temporal span').html(currentYear); // change grade value to that currently selected by UI slider

    temporalLegend.addTo(map); // add the temporal legend to the map

  }; // end createTemporalLegend function


</script>
</body>

</html>
